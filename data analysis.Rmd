```{r}
# --- Loading Packages ---
library(readr) 
library(dplyr)
library(tidyr)
library(stringr)
library(ggplot2)
library(VennDiagram)
library(grid)
```

```{r}
# --- Loading Files ---
intolerome_path <- "/Users/hassan/Desktop/UCSF Lab Work/CGA App/data/Intolerome.tsv"
ctd_path <- "/Users/hassan/Desktop/UCSF Lab Work/CGA App/data/CTD_chem_gene_ixns.tsv"

intolerome <- read.delim(intolerome_path, sep = "\t")
ctd <- read.delim(ctd_path, skip = 27, sep = "\t")

```

```{r}
#Process the datasets

intolerome <- intolerome %>%
  separate('Gene.Locus', into = c("Gene_Name", "Gene_ID"), sep = "; id:") %>%
  mutate(
    Gene_Name = str_replace(Gene_Name, "name: ", ""),
    Gene_ID = str_replace(Gene_ID, ";", ""),
    Gene_ID = as.numeric(Gene_ID),
    System.Affected = str_to_sentence(System.Affected)  # Capitalizes first letter, makes rest lowercase
  )

# Clean the InteractionActions column in ctd
ctd <- ctd %>%
  mutate(InteractionActions = str_replace_all(InteractionActions, "\\^", " "),  # Replace ^ with space
         InteractionActions = str_replace_all(InteractionActions, "\\|", "; ")) # Replace | with ;
```


```{r}
# --- Merge Files ---
merged_df <- left_join(intolerome, ctd, by = c("Gene_ID" = "GeneID"), relationship = "many-to-many") %>%
  mutate(
    InteractionActions = str_replace_all(InteractionActions, "\\^", " "),
    InteractionActions = str_replace_all(InteractionActions, "\\|", "; ")
  ) %>%
  filter(Organism == "Homo sapiens")
```

```{r}
# --- Intolerome Analysis ---
head(intolerome)

# Print initial statistics
cat("Initial GeneData Statistics:\n")
cat("Total genes:", length(intolerome$Gene_Name), "\n")


```
```{r}
# Count the occurrences of each gene
gene_counts <- table(intolerome$Gene_Name)

# Find genes that appear exactly 3 times
repeated_genes <- names(gene_counts[gene_counts == 2])

# Display the repeated genes
cat("Genes that appear exactly 3 times:", repeated_genes, "\n")

# Genes that appear exactly 3 times
repeated_genes <- c("CRPPA", "MMUT", "TBX1")

# Filter the rows where the Gene_Name is one of the repeated genes
filtered_rows <- intolerome[intolerome$Gene_Name %in% repeated_genes, ]

# Print the filtered rows
print(filtered_rows)

```



```{r}
# --- Distributions in Intolerome ---
# Function to create a bar plot with customizable fill and color
plot_distribution <- function(data, column_name, title, fill_color = "steelblue", border_color = "black") {
  formatted_column_name <- str_replace_all(column_name, "[._]", " ")  # Format column name for axis
  
  distribution <- data %>%
    count(!!sym(column_name), name = "Count") %>%
    arrange(desc(Count))
  
  ggplot(distribution, aes(x = reorder(!!sym(column_name), -Count), y = Count)) +
    geom_bar(stat = "identity", fill = fill_color, color = border_color) +  # Use user-defined colors
    geom_text(aes(label = Count), vjust = -0.3, size = 4) +  # Annotate with counts
    labs(title = title,
         x = formatted_column_name,  # Use formatted column name with spaces
         y = "Frequency") +
    theme_minimal() +
    theme(
      axis.text.x = element_text(angle = 45, hjust = 1),  # Rotate x-axis labels for readability
      plot.title = element_text(hjust = 0.5, face = "bold")  # Center and bold title
    )
}

# Plot distributions for Gene Effect, System Affected, Lethality Mode of Function
p1 <- plot_distribution(intolerome, "Gene.Effect", "Distribution of Gene Effect")
p2 <- plot_distribution(intolerome, "System.Affected", "Distribution of System Affected")
p3 <- plot_distribution(intolerome, "Lethality.Mode.of.Function", "Distribution of Lethality Mode of Function")

# Merge the Lethality Timing columns and properly rename them
lethality_timing_long <- intolerome %>%
  rename(
    "Trimester 1st" = X1st,
    "Trimester 2nd" = X2nd,
    "Trimester 3rd" = X3rd,
    "Post natal" = Postnatal
  ) %>%
  select("Trimester 1st", "Trimester 2nd", "Trimester 3rd", "Post natal") %>%
  pivot_longer(cols = everything(), names_to = "Lethality_Timing", values_to = "Presence") %>%
  filter(!is.na(Presence)) %>%  # Remove empty values if any
  count(Lethality_Timing, name = "Count")

# Plot Lethality Timing distribution
p4 <- ggplot(lethality_timing_long, aes(x = reorder(Lethality_Timing, -Count), y = Count)) +
  geom_bar(stat = "identity", fill = "steelblue", color = "black") +
  geom_text(aes(label = Count), vjust = -0.3, size = 4) +
  labs(title = "Distribution of Lethality Timing",
       x = "Lethality Timing",
       y = "Frequency") +
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),
    plot.title = element_text(hjust = 0.5, face = "bold")  # Center and bold title
  )

# Print the plots
print(p1)
print(p2)
print(p3)
print(p4)



```

```{r}
# --- CTD Analysis ---
head(ctd)

cat("\nInitial CTD Dataset Statistics:\n")
cat("Total interactions:", nrow(ctd), "\n")
cat("Total unique chemicals:", n_distinct(ctd$X..ChemicalName), "\n")
cat("Total unique genes in CTD:", n_distinct(ctd$GeneID), "\n\n")

ctd_filtered <- ctd %>%
  filter(Organism == "Homo sapiens") 

# Print initial statistics after filtering for Organism == Homo sapeiens
cat("\nInitial CTD Dataset Statistics For Homo Sapiens:\n")
cat("Total interactions:", nrow(ctd_filtered), "\n")
cat("Total unique chemicals:", n_distinct(ctd_filtered$X..ChemicalName), "\n")
cat("Total unique genes in CTD:", n_distinct(ctd_filtered$GeneID), "\n\n")
```


```{r}
# --- Merged Dataset Analysis ---

# --- Initial Dataset Statistics ---
cat("\nInitial Merged Dataset Statistics (Homo sapiens):\n")
cat("Total interactions:", nrow(merged_df), "\n")
cat("Total unique chemicals:", n_distinct(merged_df$X..ChemicalName), "\n")
cat("Total unique genes:", n_distinct(merged_df$Gene_ID), "\n\n")

# --- Distributions ---
p1 <- plot_distribution(merged_df, "Gene.Effect", "Distribution of Gene Effect", fill_color = "lavender", border_color = "black")
p2 <- plot_distribution(merged_df, "System.Affected", "Distribution of System Affected", fill_color = "lightcoral", border_color = "black")
p3 <- plot_distribution(merged_df, "Lethality.Mode.of.Function", "Distribution of Lethality Mode of Function", fill_color = "lightseagreen", border_color = "black")

# --- Lethality Timing Distribution ---
head(merged_df)
lethality_timing_long <- merged_df %>%
  rename(
    "Trimester 1st" = X1st,
    "Trimester 2nd" = X2nd,
    "Trimester 3rd" = X3rd,
    "Post natal" = Postnatal
  ) %>%
  select("Trimester 1st", "Trimester 2nd", "Trimester 3rd", "Post natal") %>%
  pivot_longer(cols = everything(), names_to = "Lethality_Timing", values_to = "Presence") %>%
  filter(!is.na(Presence)) %>%  # Remove empty values
  count(Lethality_Timing, name = "Count")

p4 <- ggplot(lethality_timing_long, aes(x = reorder(Lethality_Timing, -Count), y = Count)) +
  geom_bar(stat = "identity", fill = "lightblue", color = "black") +
  geom_text(aes(label = Count), vjust = -0.3, size = 4) +
  labs(title = "Distribution of Lethality Timing",
       x = "Lethality Timing",
       y = "Frequency") +
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),
    plot.title = element_text(hjust = 0.5, face = "bold")  # Center and bold title
  )

# --- Print the Plots ---
print(p1)
print(p2)
print(p3)
print(p4)
```
```{r}
# --- Function to Create Bar Plot Distributions for Unique Genes ---
plot_distribution_unique_genes <- function(data, column_name, title, fill_color = "steelblue", border_color = "black") {
  formatted_column_name <- str_replace_all(column_name, "[._]", " ")  # Format column name for axis
  
  distribution <- data %>%
    distinct(Gene_ID, !!sym(column_name)) %>%  # Keep only unique Gene_ID per category
    count(!!sym(column_name), name = "Count") %>%
    arrange(desc(Count))
  
  ggplot(distribution, aes(x = reorder(!!sym(column_name), -Count), y = Count)) +
    geom_bar(stat = "identity", fill = fill_color, color = border_color) +  # Use user-defined colors
    geom_text(aes(label = Count), vjust = -0.3, size = 4) +  # Annotate with counts
    labs(title = title,
         x = formatted_column_name,  # Use formatted column name with spaces
         y = "Unique Gene Count") +  # Updated y-label to reflect unique genes
    theme_minimal() +
    theme(
      axis.text.x = element_text(angle = 45, hjust = 1),  # Rotate x-axis labels for readability
      plot.title = element_text(hjust = 0.5, face = "bold"),  # Center and bold title
      panel.grid.major = element_blank(),  # Remove major grid lines
      panel.grid.minor = element_blank()   # Remove minor grid lines
    )
}

# --- Initial Dataset Statistics ---
cat("\nInitial Merged Dataset Statistics (Homo sapiens):\n")
cat("Total interactions:", nrow(merged_df), "\n")
cat("Total unique chemicals:", n_distinct(merged_df$X..ChemicalName), "\n")
cat("Total unique genes:", n_distinct(merged_df$Gene_ID), "\n\n")

# --- Unique Gene Distributions ---
p1 <- plot_distribution_unique_genes(merged_df, "Gene.Effect", "Distribution of Gene Effect (Unique Genes)", fill_color = "lavender", border_color = "black")
p2 <- plot_distribution_unique_genes(merged_df, "System.Affected", "Distribution of System Affected (Unique Genes)", fill_color = "lightcoral", border_color = "black")
p3 <- plot_distribution_unique_genes(merged_df, "Lethality.Mode.of.Function", "Distribution of Lethality Mode of Function (Unique Genes)", fill_color = "lightseagreen", border_color = "black")

# --- Lethality Timing Distribution (Based on Unique Genes) ---
head(merged_df)
lethality_timing_long <- merged_df %>%
  rename(
    "Trimester 1st" = X1st,
    "Trimester 2nd" = X2nd,
    "Trimester 3rd" = X3rd,
    "Post natal" = Postnatal
  ) %>%
  select(Gene_ID, "Trimester 1st", "Trimester 2nd", "Trimester 3rd", "Post natal") %>%  # Keep Gene_ID to ensure uniqueness
  pivot_longer(cols = -Gene_ID, names_to = "Lethality_Timing", values_to = "Presence") %>%
  filter(!is.na(Presence)) %>%  # Remove empty values
  distinct(Gene_ID, Lethality_Timing) %>%  # Ensure each gene is counted once per category
  count(Lethality_Timing, name = "Count")

p4 <- ggplot(lethality_timing_long, aes(x = reorder(Lethality_Timing, -Count), y = Count)) +
  geom_bar(stat = "identity", fill = "lightblue", color = "black") +
  geom_text(aes(label = Count), vjust = -0.3, size = 4) +
  labs(title = "Distribution of Lethality Timing (Unique Genes)",
       x = "Lethality Timing",
       y = "Unique Gene Count") +
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),
    plot.title = element_text(hjust = 0.5, face = "bold"),  # Center and bold title
    panel.grid.major = element_blank(),  # Remove major grid lines
    panel.grid.minor = element_blank()   # Remove minor grid lines
  )

# --- Print the Plots ---
print(p1)
print(p2)
print(p3)
print(p4)

```

```{r}
# --- RPL Genes ---

# Define the genes of interest
genes_of_interest <- c("AURKB", "F2", "F5", "FOXD1", "PADI6")

# Filter the dataframe to include only rows where Gene_Name is in the list
rpl_df <- merged_df[merged_df$Gene_Name %in% genes_of_interest, ]

# Print the extracted rows
print(rpl_df)

write.csv(filtered_rows, "/Users/hassan/Desktop/UCSF Lab Work/CGA App/data/rpl_genes.csv", row.names = FALSE)

```

```{r}
# --- RPL Analysis ---

# Loop through each gene and print the number of rows in rpl_data
cat("\n-------Number of Interactions-------\n")
for (gene in genes_of_interest) {
  num_rows <- nrow(rpl_df[rpl_df$Gene_Name == gene, ])
  cat("Gene:", gene, "- Number of rows:", num_rows, "\n")
}
cat("\n-------Unique Chemicals-------\n")
# Loop through each gene and print the number of unique chemicals
for (gene in genes_of_interest) {
  unique_chemicals <- unique(rpl_df$X..ChemicalName[rpl_df$Gene_Name == gene])
  num_unique_chemicals <- length(unique_chemicals)
  cat("Gene:", gene, "- Unique chemicals:", num_unique_chemicals, "\n")
}


```

```

```{r}
# Extract all chemicals associated with each gene dynamically
chemical_data <- split(rpl_df$X..ChemicalName, rpl_df$Gene_Name)

# Convert each list element to a unique set
chemical_data <- lapply(chemical_data, unique)

# Print number of chemicals per gene
sapply(chemical_data, length)

# Function to calculate set intersections
calc_intersection <- function(...) {
  Reduce(intersect, list(...))
}

# List of genes
genes <- names(chemical_data)

# Generate all possible gene intersections
intersection_counts <- list()

for (i in 1:length(genes)) {
  for (j in (i+1):length(genes)) {
    intersection_counts[[paste(genes[i], genes[j], sep="_")]] <- length(intersect(chemical_data[[genes[i]]], chemical_data[[genes[j]]]))
  }
}

# Print all computed intersections
print(intersection_counts)

# Create empty matrix
overlap_matrix <- matrix(0, nrow = length(genes), ncol = length(genes))
rownames(overlap_matrix) <- genes
colnames(overlap_matrix) <- genes

# Fill matrix with intersection counts
for (i in 1:length(genes)) {
  for (j in 1:length(genes)) {
    overlap_matrix[i, j] <- length(intersect(chemical_data[[genes[i]]], chemical_data[[genes[j]]]))
  }
}

# Print the 5x5 overlap matrix
print(overlap_matrix)

```

```{r}
# Compute all required pairwise, triple, quadruple, and quintuple intersections
n12 <- length(intersect(chemical_data[[genes[1]]], chemical_data[[genes[2]]]))
n13 <- length(intersect(chemical_data[[genes[1]]], chemical_data[[genes[3]]]))
n14 <- length(intersect(chemical_data[[genes[1]]], chemical_data[[genes[4]]]))
n15 <- length(intersect(chemical_data[[genes[1]]], chemical_data[[genes[5]]]))
n23 <- length(intersect(chemical_data[[genes[2]]], chemical_data[[genes[3]]]))
n24 <- length(intersect(chemical_data[[genes[2]]], chemical_data[[genes[4]]]))
n25 <- length(intersect(chemical_data[[genes[2]]], chemical_data[[genes[5]]]))
n34 <- length(intersect(chemical_data[[genes[3]]], chemical_data[[genes[4]]]))
n35 <- length(intersect(chemical_data[[genes[3]]], chemical_data[[genes[5]]]))
n45 <- length(intersect(chemical_data[[genes[4]]], chemical_data[[genes[5]]]))

# Triple intersections
n123 <- length(Reduce(intersect, list(chemical_data[[genes[1]]], chemical_data[[genes[2]]], chemical_data[[genes[3]]])))
n124 <- length(Reduce(intersect, list(chemical_data[[genes[1]]], chemical_data[[genes[2]]], chemical_data[[genes[4]]])))
n125 <- length(Reduce(intersect, list(chemical_data[[genes[1]]], chemical_data[[genes[2]]], chemical_data[[genes[5]]])))
n134 <- length(Reduce(intersect, list(chemical_data[[genes[1]]], chemical_data[[genes[3]]], chemical_data[[genes[4]]])))
n135 <- length(Reduce(intersect, list(chemical_data[[genes[1]]], chemical_data[[genes[3]]], chemical_data[[genes[5]]])))
n145 <- length(Reduce(intersect, list(chemical_data[[genes[1]]], chemical_data[[genes[4]]], chemical_data[[genes[5]]])))
n234 <- length(Reduce(intersect, list(chemical_data[[genes[2]]], chemical_data[[genes[3]]], chemical_data[[genes[4]]])))
n235 <- length(Reduce(intersect, list(chemical_data[[genes[2]]], chemical_data[[genes[3]]], chemical_data[[genes[5]]])))
n245 <- length(Reduce(intersect, list(chemical_data[[genes[2]]], chemical_data[[genes[4]]], chemical_data[[genes[5]]])))
n345 <- length(Reduce(intersect, list(chemical_data[[genes[3]]], chemical_data[[genes[4]]], chemical_data[[genes[5]]])))

# Quadruple intersections
n1234 <- length(Reduce(intersect, list(chemical_data[[genes[1]]], chemical_data[[genes[2]]], chemical_data[[genes[3]]], chemical_data[[genes[4]]])))
n1235 <- length(Reduce(intersect, list(chemical_data[[genes[1]]], chemical_data[[genes[2]]], chemical_data[[genes[3]]], chemical_data[[genes[5]]])))
n1245 <- length(Reduce(intersect, list(chemical_data[[genes[1]]], chemical_data[[genes[2]]], chemical_data[[genes[4]]], chemical_data[[genes[5]]])))
n1345 <- length(Reduce(intersect, list(chemical_data[[genes[1]]], chemical_data[[genes[3]]], chemical_data[[genes[4]]], chemical_data[[genes[5]]])))
n2345 <- length(Reduce(intersect, list(chemical_data[[genes[2]]], chemical_data[[genes[3]]], chemical_data[[genes[4]]], chemical_data[[genes[5]]])))

# Quintuple intersection (ALL 5 genes)
n12345 <- length(Reduce(intersect, list(chemical_data[[genes[1]]], chemical_data[[genes[2]]], chemical_data[[genes[3]]], chemical_data[[genes[4]]], chemical_data[[genes[5]]])))

# Print to debug if needed
cat("n12345 (all genes):", n12345, "\n")

# Draw the Venn diagram with all calculated intersections
venn.plot <- draw.quintuple.venn(
  area1 = length(chemical_data[[genes[1]]]),
  area2 = length(chemical_data[[genes[2]]]),
  area3 = length(chemical_data[[genes[3]]]),
  area4 = length(chemical_data[[genes[4]]]),
  area5 = length(chemical_data[[genes[5]]]),
  n12 = n12, n13 = n13, n14 = n14, n15 = n15,
  n23 = n23, n24 = n24, n25 = n25,
  n34 = n34, n35 = n35, n45 = n45,
  n123 = n123, n124 = n124, n125 = n125,
  n134 = n134, n135 = n135, n145 = n145,
  n234 = n234, n235 = n235, n245 = n245,
  n345 = n345,
  n1234 = n1234, n1235 = n1235, n1245 = n1245, 
  n1345 = n1345, n2345 = n2345, n12345 = n12345,
  category = genes,
  fill = c("lightcoral","lightblue", "lightseagreen", "lightyellow", "lavender"),
  cat.cex = 2.2,
  cex = 2.2,
  margin = 0.1
)

# Save the Venn diagram
png(filename = "/Users/hassan/Desktop/UCSF Lab Work/CGA App/venn_diagram.png", width = 1000, height = 1000)
grid.draw(venn.plot)
dev.off()

```

```{r}
library(ggplot2)
library(dplyr)
library(tidyr)

# Convert lethality timing columns to numeric safely
rpl_df <- rpl_df %>%
  mutate(
    X1st = suppressWarnings(as.numeric(X1st)),
    X2nd = suppressWarnings(as.numeric(X2nd)),
    X3rd = suppressWarnings(as.numeric(X3rd)),
    Postnatal = suppressWarnings(as.numeric(Postnatal))
  )

# Count unique chemical interactions per gene, considering lethality timing
chemical_counts <- rpl_df %>%
  group_by(Gene_Name, X..ChemicalName) %>%  # Group by gene and unique chemicals
  summarise(
    "Trimester 1st" = sum(X1st, na.rm = TRUE),
    "Trimester 2nd" = sum(X2nd, na.rm = TRUE),
    "Trimester 3rd" = sum(X3rd, na.rm = TRUE),
    "Post natal" = sum(Postnatal, na.rm = TRUE),
    .groups = "drop"
  )

# Convert to long format for plotting
lethality_timing_long <- chemical_counts %>%
  pivot_longer(cols = c("Trimester 1st", "Trimester 2nd", "Trimester 3rd", "Post natal"),
               names_to = "Lethality_Timing", values_to = "Count") %>%
  filter(Count > 0) %>%  # Remove zero counts
  group_by(Gene_Name, Lethality_Timing) %>%
  summarise(Total_Chemicals = sum(Count), .groups = "drop")

# Plot
p5 <- ggplot(lethality_timing_long, aes(x = Gene_Name, y = Total_Chemicals, fill = Lethality_Timing)) +
  geom_bar(stat = "identity", color = "black") +
  geom_text(aes(label = Total_Chemicals), position = position_stack(vjust = 0.5), size = 4) +
  labs(title = "Lethality Timing Distribution Based on Unique Chemical Interactions",
       x = "Gene",
       y = "Number of Unique Chemical Interactions",
       fill = "Lethality Timing") +
  theme_minimal() +
  theme(
    plot.title = element_text(hjust = 0.5, face = "bold"),
    axis.text.x = element_text(angle = 45, hjust = 1)
  )

print(p5)
summary(rpl_df$X1st)
summary(rpl_df$X2nd)
summary(rpl_df$X3rd)
summary(rpl_df$Postnatal)

print(length(chemical_counts))


```

```{r}

library(dplyr)
library(tidyr)
library(ggplot2)

# --- Process Lethality Timing for Each Gene Using Unique Chemicals ---
lethality_timing_stacked <- rpl_df %>%
  rename(
    "Trimester 1st" = X1st,
    "Trimester 2nd" = X2nd,
    "Trimester 3rd" = X3rd,
    "Post natal" = Postnatal
  ) %>%
  select(Gene_Name, X..ChemicalName, "Trimester 1st", "Trimester 2nd", "Trimester 3rd", "Post natal") %>%
  pivot_longer(cols = c("Trimester 1st", "Trimester 2nd", "Trimester 3rd", "Post natal"), 
               names_to = "Lethality_Timing", values_to = "Presence") %>%
  filter(!is.na(Presence) & Presence != "") %>%  # Remove empty values
  distinct(Gene_Name, X..ChemicalName, Lethality_Timing) %>%  # Ensure uniqueness per gene-chemical-timing
  group_by(Gene_Name, Lethality_Timing) %>%
  summarise(Unique_Chemicals = n(), .groups = "drop")  # Count unique chemicals per gene-lethality timing

# --- Plot the Stacked Bar Chart ---
p_stacked_unique <- ggplot(lethality_timing_stacked, aes(x = Gene_Name, y = Unique_Chemicals, fill = Lethality_Timing)) +
  geom_bar(stat = "identity", color = "black") +
  geom_text(aes(label = Unique_Chemicals), position = position_stack(vjust = 0.5), size = 4) +
  labs(title = "Stacked Lethality Timing Distribution (Unique Chemicals per Gene)",
       x = "Gene",
       y = "Number of Unique Chemicals",
       fill = "Lethality Timing") +
  theme_minimal() +
  theme(
    plot.title = element_text(hjust = 0.5, face = "bold"),
    axis.text.x = element_text(angle = 45, hjust = 1)
  )

# --- Print the Plot ---
print(p_stacked_unique)





```

```{r}
library(ggplot2)
library(reshape2)

# Pivot lethality timing data for heatmap
lethality_matrix <- rpl_df %>%
  rename(
    "Trimester 1st" = X1st,
    "Trimester 2nd" = X2nd,
    "Trimester 3rd" = X3rd,
    "Post natal" = Postnatal
  ) %>%
  select(Gene_Name, "Trimester 1st", "Trimester 2nd", "Trimester 3rd", "Post natal") %>%
  pivot_longer(cols = -Gene_Name, names_to = "Lethality_Timing", values_to = "Presence") %>%
  filter(!is.na(Presence) & Presence != "") %>%
  count(Gene_Name, Lethality_Timing) %>%
  spread(Lethality_Timing, n, fill = 0)  # Convert to wide format

# Convert to matrix for heatmap
heatmap_matrix <- as.matrix(lethality_matrix[,-1])
rownames(heatmap_matrix) <- lethality_matrix$Gene_Name

# Plot heatmap
library(pheatmap)
pheatmap(heatmap_matrix, main = "Lethality Timing Across RPL Genes", color = colorRampPalette(c("white", "lightseagreen"))(50))

```

```{r}
library(ggplot2)
library(dplyr)

# Count top 15 chemicals
chemicals <- rpl_df %>%
  count(X..ChemicalName, sort = TRUE) %>%
  top_n(20)  # Select top 20 chemicals

# Remove the 15th ranked chemical
chemicals <- chemicals[-15, ]  # Drops the 15th row

# Adjust font size and plot dimensions
p <- ggplot(chemicals, aes(x = reorder(X..ChemicalName, n), y = n)) +
  geom_bar(stat = "identity", fill = "lightseagreen") +
  coord_flip() +
  labs(title = "Top 20 Chemicals For RPL Genes",
       x = "Chemical Name",
       y = "Count") +
  scale_y_continuous(limits = c(0, 12), breaks = seq(0, 12, by = 2)) +
  theme_minimal() +
  theme(
    plot.margin = margin(0.5, 0.5, 0.5, 0.5, "cm"),
    axis.text.y = element_text(size = 8),
    axis.text.x = element_text(size = 8),
    plot.title = element_text(size = 14, face = "bold")
  )
print(p)




```


```{r}
library(dplyr)
library(visNetwork)

# Filter out F2 from the data

# Extract unique genes and chemicals from the filtered data
unique_genes <- unique(rpl_df$Gene_Name)
unique_chemicals <- unique(rpl_df$X..ChemicalName)

# Create nodes: one node for each unique gene and one for each unique chemical
nodes <- data.frame(
  id    = c(unique_genes, unique_chemicals),
  label = c(unique_genes, unique_chemicals),
  group = c(rep("Gene", length(unique_genes)), rep("Chemical", length(unique_chemicals))),
  stringsAsFactors = FALSE
)

# Create edges for gene-to-chemical interactions
edges <- data.frame(
  from = rpl_df$Gene_Name,
  to   = rpl_df$X..ChemicalName,
  stringsAsFactors = FALSE
)

# Generate the network diagram
visNetwork(nodes, edges) %>%
  visPhysics(stabilization = list(enabled = TRUE, iterations = 500, updateInterval = 25)) %>%
  visNodes(scaling = list(min = 10, max = 30)) %>%
  visEdges(width = 1, color = "gray", arrows = "to") %>%
  visGroups(groupname = "Gene", 
            color = list(background = "lightcoral", border = "lightcoral")) %>%
  visGroups(groupname = "Chemical", 
            color = list(background = "lightseagreen", border = "lightseagreen")) %>%
  visOptions(highlightNearest = TRUE, nodesIdSelection = TRUE)

```

